import{r as i,j as e}from"./ui-Dn30SOU1.js";import"./vendor-C1XDGt3J.js";function je({onClose:r,newScore:t=null,difficulty:a="easy",moves:s=0,streak:d=0,timeSeconds:u=null}){const[h,b]=i.useState(""),[f,w]=i.useState(!1),[q,c]=i.useState([]);i.useEffect(()=>{z(),t!==null&&t>0&&w(!0)},[t]),i.useEffect(()=>{const o=x=>{x.key==="Escape"&&r?.()};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[r]);const z=()=>{const o=localStorage.getItem("gameLeaderboard"),x=o?JSON.parse(o):[];c(x.sort((A,T)=>T.score-A.score).slice(0,20))},B=()=>{if(!h.trim())return;const o={name:h.trim(),score:t,difficulty:a,moves:s,streak:d,time:u,date:new Date().toLocaleDateString("pt-BR"),timestamp:Date.now()},x=localStorage.getItem("gameLeaderboard"),A=x?JSON.parse(x):[];A.push(o);const T=A.sort((F,m)=>m.score-F.score).slice(0,50);localStorage.setItem("gameLeaderboard",JSON.stringify(T)),c(T.slice(0,10)),w(!1),b(""),window.updateStats&&window.updateStats("leaderboardEntries",1)},H=o=>{switch(o){case"easy":return"#4ade80";case"medium":return"#fbbf24";case"hard":return"#f87171";default:return"#60a5fa"}},D=o=>{switch(o){case"easy":return"Fácil";case"medium":return"Médio";case"hard":return"Difícil";default:return o}},U=o=>{o.target.classList.contains("leaderboard-overlay")&&r?.()};return e.jsx("div",{className:"leaderboard-overlay",onClick:U,children:e.jsxs("div",{className:"leaderboard-modal",role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"leaderboard-header",children:[e.jsx("h2",{children:"🏆 Ranking dos Melhores"}),e.jsx("button",{onClick:r,className:"close-btn",children:"✖"})]}),f&&e.jsxs("div",{className:"name-input-section",children:[e.jsx("h3",{children:"🎉 Novo Record! Digite seu nome:"}),e.jsxs("div",{className:"score-preview",children:[e.jsxs("span",{children:["Pontuação: ",t]}),e.jsxs("span",{children:["Movimentos: ",s]}),e.jsxs("span",{children:["Streak: ",d,"x"]}),u!==null&&e.jsxs("span",{children:["Tempo: ",u,"s"]})]}),e.jsxs("div",{className:"name-input-group",children:[e.jsx("input",{type:"text",value:h,onChange:o=>b(o.target.value),placeholder:"Seu nome aqui...",maxLength:20,onKeyPress:o=>o.key==="Enter"&&B(),autoFocus:!0}),e.jsx("button",{onClick:B,disabled:!h.trim(),children:"Salvar"})]})]}),e.jsx("div",{className:"leaderboard-list",children:q.length===0?e.jsxs("div",{className:"empty-leaderboard",children:[e.jsx("p",{children:"🎮 Seja o primeiro a entrar no ranking!"}),e.jsx("p",{children:"Complete um jogo para aparecer aqui!"})]}):q.map((o,x)=>e.jsxs("div",{className:`leaderboard-entry ${x<3?"podium":""}`,children:[e.jsx("div",{className:"position",children:x===0?"🥇":x===1?"🥈":x===2?"🥉":`#${x+1}`}),e.jsxs("div",{className:"player-info",children:[e.jsx("div",{className:"player-name",children:o.name}),e.jsxs("div",{className:"player-details",children:[e.jsx("span",{style:{color:H(o.difficulty)},children:D(o.difficulty)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:o.date})]})]}),e.jsxs("div",{className:"player-stats",children:[e.jsxs("div",{className:"score",children:[o.score,"pt"]}),e.jsxs("div",{className:"sub-stats",children:[e.jsxs("span",{children:[o.moves,"mov"]}),e.jsxs("span",{children:[o.streak,"x"]}),o.time?e.jsxs("span",{children:[o.time,"s"]}):null]})]})]},`${o.timestamp}-${x}`))}),e.jsxs("div",{className:"leaderboard-footer",children:[e.jsx("p",{children:"🎯 Complete jogos para entrar no ranking!"}),e.jsx("p",{children:"📊 Pontuação considera tempo, movimentos e dificuldade"})]})]})})}class ke{constructor(){this.isInitialized=!1,this.touchStarted=!1,this.audioContext=null,this.isPlayingBackground=!1,this.backgroundInterval=null,this.onInitialized=null,this.setupAudioUnlock()}async initialize(){return this.initAudio()}setupAudioUnlock(){const t=async()=>{this.touchStarted||(console.log("🎵 Audio unlock triggered by user interaction"),this.touchStarted=!0,await this.initAudio(),document.removeEventListener("touchstart",t),document.removeEventListener("click",t))};document.addEventListener("touchstart",t,{passive:!0}),document.addEventListener("click",t)}async initAudio(){try{console.log("🎵 Initializing audio context..."),this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioContext.state==="suspended"&&(await this.audioContext.resume(),console.log("🎵 Audio context resumed")),this.isInitialized=!0,console.log("✅ Audio engine initialized successfully"),this.onInitialized&&this.onInitialized(!0)}catch(t){console.error("❌ Audio initialization failed:",t),this.isInitialized=!1,this.onInitialized&&this.onInitialized(!1)}}async playTone(t,a,s=.1,d=!0,u=.8){if(!d||!this.isInitialized||!this.audioContext){console.log("🔇 Audio disabled or not initialized");return}try{const h=this.audioContext.createOscillator(),b=this.audioContext.createGain();h.connect(b),b.connect(this.audioContext.destination),h.frequency.setValueAtTime(t,this.audioContext.currentTime),h.type="sine",b.gain.setValueAtTime(0,this.audioContext.currentTime),b.gain.linearRampToValueAtTime(s*u,this.audioContext.currentTime+.01),b.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+a),h.start(this.audioContext.currentTime),h.stop(this.audioContext.currentTime+a),console.log(`🎵 Playing tone: ${t}Hz`)}catch(h){console.warn("🔇 Tone playback failed:",h)}}playSweep(t,a,s=.18,d=.08,u="sine",h=!0,b=.8){if(!(!h||!this.isInitialized||!this.audioContext))try{const f=this.audioContext.createOscillator(),w=this.audioContext.createGain();f.type=u,f.frequency.setValueAtTime(t,this.audioContext.currentTime),f.frequency.linearRampToValueAtTime(a,this.audioContext.currentTime+s),w.gain.setValueAtTime(1e-4,this.audioContext.currentTime),w.gain.exponentialRampToValueAtTime(d*b,this.audioContext.currentTime+.01),w.gain.exponentialRampToValueAtTime(1e-4,this.audioContext.currentTime+s),f.connect(w),w.connect(this.audioContext.destination),f.start(),f.stop(this.audioContext.currentTime+s)}catch(f){console.warn("🔇 Sweep playback failed:",f)}}vibrate(t=[50],a=!0){a&&navigator.vibrate&&navigator.vibrate(t)}onCardFlip(t,a,s){this.playTone(800,.1,.1,t,a),this.vibrate([30],s)}onCardMatch(t,a,s){[900,1200,1500].forEach((d,u)=>setTimeout(()=>this.playTone(d,.12,.12,t,a),u*90)),this.vibrate([50,30,50],s)}onCardMiss(t,a,s){this.playSweep(900,280,.2,.08,"triangle",t,a),this.vibrate([100],s)}onGameComplete(t,a,s){[800,1e3,1200,1400,1600].forEach((d,u)=>{setTimeout(()=>this.playTone(d,.2,.15,t,a),u*150)}),this.vibrate([200,100,200,100,300],s)}playSitioMelody(t,a){[523,659,784,1047,880,698,784,659].forEach((s,d)=>{setTimeout(()=>this.playTone(s,.4,.12,t,a),d*500)})}onStreakMilestone(t,a,s,d){const u=t>=8?520:t>=5?440:360;(t>=8?[0,4,7,12,16]:t>=5?[0,4,7,12]:[0,3,7]).forEach((b,f)=>setTimeout(()=>this.playTone(u*Math.pow(2,b/12),.14,.12,a,s),f*110)),this.vibrate([40,20,60,20,80],d)}onComboBreak(t,a,s){this.playSweep(1e3,220,.18,.09,"sawtooth",t,a),this.vibrate([150,50,100],s)}onNearWin(t,a,s){this.playSweep(420,980,.25,.1,"sine",t,a),this.vibrate([30,30,30],s)}startBackgroundMusic(t,a){this.isPlayingBackground||!t||(this.isPlayingBackground=!0,this.backgroundInterval=setInterval(()=>{if(this.isPlayingBackground&&Math.random()>.8){const s=[523,587,659,698,784,880,988];this.playTone(s[Math.floor(Math.random()*s.length)],.1,.05,t,a)}},3e3))}stopBackgroundMusic(){this.isPlayingBackground=!1,this.backgroundInterval&&(clearInterval(this.backgroundInterval),this.backgroundInterval=null)}}const Me=[{name:"Emília",img:"./characters/emilia.png"},{name:"Narizinho",img:"./characters/narizinho.png"},{name:"Pedrinho",img:"./characters/pedrinho.png"},{name:"Visconde",img:"./characters/visconde.png"},{name:"Dona Benta",img:"./characters/dona_benta.png"},{name:"Tia Nastácia",img:"./characters/tia_nastacia.png"},{name:"Saci",img:"./characters/saci.png"},{name:"Cuca",img:"./characters/cuca.png"},{name:"Rabicó",img:"./characters/rabico.png"},{name:"Tio Barnabé",img:"./characters/barnabe.png"},{name:"Quindim",img:"./characters/quindim.png"},{name:"Conselheiro",img:"./characters/conselheiro.png"}];function ce(r){const t=[...r];for(let a=t.length-1;a>0;a--){const s=Math.floor(Math.random()*(a+1));[t[a],t[s]]=[t[s],t[a]]}return t}function Ne({musicPlaying:r}){const[t,a]=i.useState([]),[s,d]=i.useState([]),[u,h]=i.useState([]),[b,f]=i.useState(0),[w,q]=i.useState(!1),[c]=i.useState(()=>localStorage.getItem("memoryDifficulty")||"easy"),[z,B]=i.useState(0),[H,D]=i.useState(!1),[U,o]=i.useState(!1),[x,A]=i.useState(!1),[T,F]=i.useState(0),[m]=i.useState(()=>new ke),[E,le]=i.useState(!!r),[ee,J]=i.useState(!1),[K,_]=i.useState(!1),[Q,X]=i.useState(!1),[P,de]=i.useState(!1),[L,ue]=i.useState(!1),[y,he]=i.useState(!0),[S,me]=i.useState(.8),[N,pe]=i.useState(!0),[I,fe]=i.useState(!0),[te,ie]=i.useState(!1),[Y,se]=i.useState(0),C=i.useRef(null),[ge,ae]=i.useState(null),[ne,xe]=i.useState(3),[oe,be]=i.useState(120);i.useEffect(()=>{console.log("🎵 Setting up audio engine initialization callback..."),m?(m.onInitialized=n=>{console.log(`🎵 Audio engine initialization: ${n?"SUCCESS":"FAILED"}`),ue(n),n?(console.log("✅ Audio engine ready for game sounds"),setTimeout(()=>{console.log("🔊 Testing audio with brief tone..."),m.playTone(440,.1,.05,y,S).catch(l=>console.warn("Test tone failed:",l))},500)):console.error("❌ Audio engine failed to initialize - sounds will not work")},console.log("🎵 Triggering audio engine initialization..."),m.initialize()):console.error("❌ Audio engine instance not available")},[m,y,S]),i.useEffect(()=>{le(!!r)},[r]);const $=i.useMemo(()=>{switch(c){case"easy":return 3;case"medium":return 6;case"hard":return 12;default:return 3}},[c]),re=i.useCallback(()=>{const n=ce(Me).slice(0,$),l=ce([...n,...n]).map((j,g)=>({...j,id:j.name+g,uniqueId:g}));if(a(l),d([]),h([]),f(1e3),B(0),q(!1),D(!1),F(0),J(!1),_(!1),X(!1),ie(!1),se(0),ae(null),C.current&&(clearInterval(C.current),C.current=null),window.sitioMusicEngine&&(r||E)&&I)try{window.sitioMusicEngine.start("reset",{difficulty:c})}catch{}},[$,c,r,E,m,I]);i.useEffect(()=>{if(document.documentElement.style.setProperty("--theme-primary",""),re(),window.sitioMusicEngine&&(r||E))try{window.sitioMusicEngine.start("exploration",{difficulty:c})}catch{}},[re,c,r,E]),i.useEffect(()=>{z>=2&&K&&_(!1)},[z,K]),i.useEffect(()=>{const n=l=>{l.key&&l.key.toLowerCase()==="p"&&X(j=>!j)};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[]);const R=i.useCallback(n=>{try{if(!P||!("speechSynthesis"in window))return;const l=new SpeechSynthesisUtterance(n);l.lang="pt-BR",l.rate=1,window.speechSynthesis.cancel(),window.speechSynthesis.speak(l)}catch{}},[P]),ve=i.useCallback(n=>{if(Q||s.length>=2||s.includes(n)||u.includes(n)||w)return;if(ee||J(!0),!te){ie(!0);const g=performance.now(),k=()=>{se(Math.max(0,Math.floor(performance.now()-g)))};C.current=setInterval(k,1e3)}m?.onCardFlip(y,S,N);const l=t[n];l?.name&&R(l.name);const j=[...s,n];if(d(j),B(g=>g+1),j.length===2){const[g,k]=j,O=t[g],V=t[k];setTimeout(()=>{if(O.name===V.name){m?.onCardMatch(y,S,N),R(`Par! ${O.name}`);const p=[...u,g,k];if(h(p),f(v=>v+50),F(v=>{const M=v+1;if((M===3||M===5||M===8)&&(m?.onStreakMilestone(M,y,S,N),window.sitioMusicEngine&&(r||E)&&I))try{window.sitioMusicEngine.start("action",{difficulty:c,streak:M})}catch{}return M}),setTimeout(()=>{const v=document.querySelectorAll(".card");v[g]?.classList.add("matched"),v[k]?.classList.add("matched"),setTimeout(()=>{v[g]?.classList.remove("matched"),v[k]?.classList.remove("matched")},600)},0),p.length===t.length){q(!0),D(!0),m?.onGameComplete(y,S,N),J(!1),R("Você venceu!"),C.current&&(clearInterval(C.current),C.current=null);const v=Math.max(1,Math.round(Y/1e3)),M=Math.floor(t.length/2),Z=c==="hard"?2:c==="medium"?1.5:1,W=Math.max(0,1e4-v*25),ye=Math.max(0,z-M*2)*10,Se=Math.max(0,W-ye),Ce=Math.round(Se*Z+T*50);if(ae(Ce),window.sitioMusicEngine&&(r||E)&&I)try{window.sitioMusicEngine.start("victory",{difficulty:c,moves:z,streak:T}),window.sitioMusicEngine.playVictoryMelody()}catch{}setTimeout(()=>D(!1),1e3),setTimeout(()=>o(!0),350)}else if(t.length-p.length===2&&(m?.onNearWin(y,S,N),window.sitioMusicEngine&&(r||E)&&I))try{window.sitioMusicEngine.start("tension",{difficulty:c})}catch{}}else{if(m?.onCardMiss(y,S,N),R("Tente novamente"),f(p=>Math.max(0,p-10)),T>0&&m?.onComboBreak(y,S,N),F(0),window.sitioMusicEngine&&(r||E)&&I)try{window.sitioMusicEngine.start("puzzle",{difficulty:c})}catch{}setTimeout(()=>{const p=document.querySelectorAll(".card");p[g]?.classList.add("miss"),p[k]?.classList.add("miss"),setTimeout(()=>{p[g]?.classList.remove("miss"),p[k]?.classList.remove("miss")},350)},0)}d([])},800)}},[s,u,w,t,z,m,te,c,Y,E,r,R,T,ee,Q]),G=i.useCallback(()=>{const n=t.length||$*2;if(!n)return;const l=Math.max(320,window.innerWidth),j=Math.max(400,window.innerHeight),g=12,k=24,O=24;let V={size:0,cols:2};for(let p=2;p<=Math.min(n,8);p++){const v=Math.ceil(n/p),M=Math.floor((l-k*2-g*(p-1))/p),Z=Math.floor((j-O*2-g*(v-1))/v),W=Math.max(48,Math.min(M,Z));W>V.size&&(V={size:W,cols:p,rows:v})}xe(V.cols),be(V.size)},[t.length,$]);i.useEffect(()=>{G()},[G,c]),i.useEffect(()=>{const n=()=>G();return window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[G]);const we=`memory-container difficulty-${c} immersive`;return e.jsxs("div",{className:we,style:{"--cols":ne,"--card-size":`${oe}px`},children:[H&&e.jsx("div",{className:"celebration-overlay",children:e.jsx("div",{className:"celebration-text",children:"🎉 Parabéns! Você encontrou todos os personagens do Sítio! 🏆"})}),K&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{_(!1),R("Toque nas cartas para começar. A música cresce a cada acerto.")},children:e.jsxs("div",{style:{background:"#fff",color:"#000",border:"4px solid #000",borderRadius:16,padding:"1rem 1.25rem",maxWidth:420,textAlign:"center",fontWeight:800},children:[e.jsx("div",{style:{fontSize:"1.25rem",marginBottom:"0.5rem"},children:"👉 Toque nas cartas para começar!"}),e.jsx("div",{style:{fontSize:"0.95rem"},children:"A música do Sítio vai crescendo com seus acertos. Clique para continuar."})]})}),Q&&e.jsx("div",{className:"pause-overlay",onClick:()=>X(!1),children:e.jsx("div",{className:"pause-box",children:"PAUSADO"})}),e.jsx("button",{className:"exit-btn",onClick:()=>{confirm("Deseja sair do jogo atual? Seu progresso será perdido.")&&(C.current&&(clearInterval(C.current),C.current=null),window.dispatchEvent(new CustomEvent("sitio:navigate",{detail:"vision"})))},"aria-label":"Sair do jogo",children:"← Sair"}),e.jsx("button",{className:"settings-btn",onClick:()=>A(!0),"aria-label":"Configurações de áudio",title:L?"Audio funcionando - Clique para configurações":"Audio com problemas - Clique para verificar",style:{position:"absolute",top:"1rem",right:"1rem",background:L?"rgba(0,150,0,0.9)":"rgba(200,50,0,0.9)",color:"white",border:L?"2px solid rgba(0,200,0,0.5)":"2px solid rgba(255,100,0,0.5)",borderRadius:"50%",width:"48px",height:"48px",fontSize:"1.2rem",cursor:"pointer",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease"},children:L?"🔊":"🔇"}),e.jsx("div",{className:"memory-layout only-grid",children:e.jsx("div",{className:"grid",style:{"--cols":ne,"--card-size":`${oe}px`},children:t.map((n,l)=>e.jsxs("div",{className:`card ${s.includes(l)||u.includes(l)?"flipped":""}`,onClick:()=>ve(l),children:[e.jsxs("div",{className:"front",children:[e.jsx("img",{src:n.img,alt:n.name}),e.jsx("span",{className:"name",children:n.name})]}),e.jsx("div",{className:"back",children:e.jsxs("div",{className:"sitio-logo",children:[e.jsx("span",{className:"casa-icon",children:"🏡"}),e.jsx("span",{className:"sitio-text",children:"Sítio"})]})})]},n.uniqueId))})}),U&&e.jsx(je,{newScore:ge??b,moves:z,difficulty:c,timeSeconds:Math.max(1,Math.round(Y/1e3)),onClose:()=>o(!1)}),x&&e.jsx("div",{className:"audio-settings-overlay",onClick:()=>A(!1),children:e.jsxs("div",{className:"audio-settings-modal",onClick:n=>n.stopPropagation(),children:[e.jsx("h3",{children:"Configurações de Áudio"}),e.jsxs("div",{style:{padding:"0.5rem",margin:"0.5rem 0",background:L?"#d4edda":"#f8d7da",border:`1px solid ${L?"#c3e6cb":"#f5c6cb"}`,borderRadius:"4px",fontSize:"0.9rem"},children:["Status: ",L?"✅ Áudio Funcionando":"❌ Áudio com Problemas"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:y,onChange:()=>he(!y)})," Música de Fundo"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:I,onChange:()=>fe(!I)})," Música Dinâmica"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:N,onChange:()=>pe(!N)})," Feedback Tátil (Vibração)"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:P,onChange:()=>de(!P)})," Leitor de Tela (TTS)"]}),e.jsxs("label",{children:["Volume Efeitos: ",e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:S,onChange:n=>me(parseFloat(n.target.value))})]}),e.jsx("button",{onClick:()=>A(!1),children:"Fechar"}),!L&&e.jsx("button",{onClick:()=>{console.log("🔄 Manual audio re-initialization requested"),m?.initialize()},style:{marginLeft:"0.5rem",background:"#007bff",color:"white"},children:"Tentar Novamente"})]})})]})}export{Ne as default};
